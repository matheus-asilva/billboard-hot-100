PROUNI_INTEGRAL = sum(IN_FIN_NAOREEMB_PROUNI_INTEGR==1), PROUNI_PARCIAL = sum(IN_FIN_NAOREEMB_PROUNI_PARCIAL==1), FIES = sum(IN_FIN_REEMB_FIES==1),
TOTAL_ALUNO = n(),
NU_VIERAM_ESCOLA_PUBLICA=sum(TP_PROCEDE_EDUC_PUBLICA==1),
NU_VIERAM_ESCOLA_PRIVADA=sum(TP_PROCEDE_EDUC_PUBLICA==0),
IN_HOMENS=sum(IN_SEXO_ALUNO==0),
IN_MULHERES=sum(IN_SEXO_ALUNO==1),
IN_MATRICULA_DM_ALUNO=sum(IN_MATRICULA),
IN_CONCLUINTE_DM_ALUNO=sum(IN_CONCLUINTE),
IN_INGRESSO_TOTAL_DM_ALUNO=sum(IN_INGRESSO_TOTAL))
gc()
} else if(ano==2014 | ano==2015 | ano==2016) {
base_aluno <- dm %>% group_by(CHAVE_CURSO_MUNICIPIO) %>% summarize(NU_COTA=sum(IN_RESERVA_VAGAS),NU_SEM_COTA=sum(IN_RESERVA_VAGAS==0),
COTA_L1=sum(IN_RESERVA_VAGAS==1 & IN_RESERVA_ETNICO==0 & IN_RESERVA_DEFICIENCIA==0 & IN_RESERVA_ENSINO_PUBLICO==1 & IN_RESERVA_RENDA_FAMILIAR==1 & IN_RESERVA_OUTRA==0),
COTA_L2=sum(IN_RESERVA_VAGAS==1 & IN_RESERVA_ETNICO==1 & IN_RESERVA_DEFICIENCIA==0 & IN_RESERVA_ENSINO_PUBLICO==1 & IN_RESERVA_RENDA_FAMILIAR==1 & IN_RESERVA_OUTRA==0),
COTA_L5=sum(IN_RESERVA_VAGAS==1 & IN_RESERVA_ETNICO==0 & IN_RESERVA_DEFICIENCIA==0 & IN_RESERVA_ENSINO_PUBLICO==1 & IN_RESERVA_RENDA_FAMILIAR==0 & IN_RESERVA_OUTRA==0),
COTA_L6=sum(IN_RESERVA_VAGAS==1 & IN_RESERVA_ETNICO==1 & IN_RESERVA_DEFICIENCIA==0 & IN_RESERVA_ENSINO_PUBLICO==1 & IN_RESERVA_RENDA_FAMILIAR==0 & IN_RESERVA_OUTRA==0),
COTA_L9=sum(IN_RESERVA_VAGAS==1 & IN_RESERVA_ETNICO==0 & IN_RESERVA_DEFICIENCIA==1 & IN_RESERVA_ENSINO_PUBLICO==1 & IN_RESERVA_RENDA_FAMILIAR==1 & IN_RESERVA_OUTRA==0),
COTA_L10=sum(IN_RESERVA_VAGAS==1 & IN_RESERVA_ETNICO==1 & IN_RESERVA_DEFICIENCIA==1 & IN_RESERVA_ENSINO_PUBLICO==1 & IN_RESERVA_RENDA_FAMILIAR==1 & IN_RESERVA_OUTRA==0),
COTA_L13=sum(IN_RESERVA_VAGAS==1 & IN_RESERVA_ETNICO==0 & IN_RESERVA_DEFICIENCIA==1 & IN_RESERVA_ENSINO_PUBLICO==1 & IN_RESERVA_RENDA_FAMILIAR==0 & IN_RESERVA_OUTRA==0),
COTA_L14=sum(IN_RESERVA_VAGAS==1 & IN_RESERVA_ETNICO==1 & IN_RESERVA_DEFICIENCIA==1 & IN_RESERVA_ENSINO_PUBLICO==1 & IN_RESERVA_RENDA_FAMILIAR==0 & IN_RESERVA_OUTRA==0),
COTA_OUTROS=sum(IN_RESERVA_VAGAS==1 & IN_RESERVA_OUTRA==1),
PROUNI_INTEGRAL = sum(IN_FIN_NAOREEMB_PROUNI_INTEGR==1), PROUNI_PARCIAL = sum(IN_FIN_NAOREEMB_PROUNI_PARCIAL==1), FIES = sum(IN_FIN_REEMB_FIES==1),
TOTAL_ALUNO = n(),
NU_VIERAM_ESCOLA_PUBLICA=sum(CO_TIPO_ESCOLA_ENS_MEDIO==1),
NU_VIERAM_ESCOLA_PRIVADA=sum(CO_TIPO_ESCOLA_ENS_MEDIO==0),
IN_HOMENS=sum(IN_SEXO_ALUNO==0),
IN_MULHERES=sum(IN_SEXO_ALUNO==1),
IN_MATRICULA_DM_ALUNO=sum(IN_MATRICULA),
IN_CONCLUINTE_DM_ALUNO=sum(IN_CONCLUINTE),
IN_INGRESSO_TOTAL_DM_ALUNO=sum(IN_INGRESSO_TOTAL))
gc()
} else {
print("Ano fora do range")
}
base_aluno <- separate(base_aluno,CHAVE_CURSO_MUNICIPIO,c("CO_CURSO","CO_MUNICIPIO_CURSO","CO_MODALIDADE"))
base_aluno$CHAVE_CURSO_MUNICIPIO <- paste0(base_aluno$CO_CURSO,"|",base_aluno$CO_MUNICIPIO_CURSO,"|",base_aluno$CO_MODALIDADE)
base_curso <- dm_curso %>% group_by(CHAVE_CURSO_MUNICIPIO) %>% summarize(NU_INGRESSANTES_DM_CURSO = sum(as.numeric(QT_INGRESSO_CURSO)))
base_aluno$NU_INGRESSANTES_DM_CURSO <- base_curso[match(base_aluno$CHAVE_CURSO_MUNICIPIO,base_curso$CHAVE_CURSO_MUNICIPIO),"NU_INGRESSANTES_DM_CURSO"]$NU_INGRESSANTES_DM_CURSO
base_aluno$NO_IES <- dm[match(base_aluno$CHAVE_CURSO_MUNICIPIO,dm$CHAVE_CURSO_MUNICIPIO),"NO_IES"]$NO_IES
base_aluno$CO_IES <- dm[match(base_aluno$CHAVE_CURSO_MUNICIPIO,dm$CHAVE_CURSO_MUNICIPIO),"CO_IES"]$CO_IES
base_aluno$NO_CURSO <- dm[match(base_aluno$CHAVE_CURSO_MUNICIPIO,dm$CHAVE_CURSO_MUNICIPIO),"NO_CURSO"]$NO_CURSO
base_aluno$NO_REGIAO_CURSO <- toupper(dm_curso[match(base_aluno$CO_CURSO,dm_curso$CO_CURSO),"NO_REGIAO_CURSO"]$NO_REGIAO_CURSO)
base_aluno$NO_MODALIDADE <- toupper(dm_curso[match(base_aluno$CO_CURSO,dm_curso$CO_CURSO),"DS_MODALIDADE_ENSINO"]$DS_MODALIDADE_ENSINO)
base_aluno[base_aluno$CO_MODALIDADE=="2","IN_CAPITAL_CURSO"] <- ""
base_aluno[is.na(base_aluno$IN_CAPITAL_CURSO),"IN_CAPITAL_CURSO"] <- dm_curso[match(base_aluno[is.na(base_aluno$IN_CAPITAL_CURSO),]$CO_CURSO,dm_curso$CO_CURSO),IN_CAPITAL_CURSO]
base_aluno[base_aluno$IN_CAPITAL_CURSO=="","IN_CAPITAL_CURSO"] <- "EAD"
base_aluno[base_aluno$IN_CAPITAL_CURSO=="1","IN_CAPITAL_CURSO"] <- "CAPITAL"
base_aluno[base_aluno$IN_CAPITAL_CURSO=="0","IN_CAPITAL_CURSO"] <- "INTERIOR"
base_aluno$CO_GRUPO <- lista_grupos[match(base_aluno$CO_CURSO,lista_grupos$CO_CURSO),CO_GRUPO]
base_aluno$NO_GRUPO <- lista_grupos[match(base_aluno$CO_CURSO,lista_grupos$CO_CURSO),NO_GRUPO]
base_aluno$CHAVE_S_MODALIDADE <- paste0(base_aluno$CO_IES,"|",base_aluno$CO_GRUPO,"|",base_aluno$CO_MUNICIPIO_CURSO)
base_aluno$CHAVE <- paste0(ano,"|",base_aluno$CO_IES,"|",base_aluno$CO_GRUPO,"|",base_aluno$CO_MUNICIPIO_CURSO,"|",base_aluno$CO_MODALIDADE)
cpc3[cpc3$NO_MODALIDADE=="Educação Presencial","CO_MODALIDADE"] <- 1
cpc3[cpc3$NO_MODALIDADE=="Educação a Distância","CO_MODALIDADE"] <- 2
cpc3[cpc3$CO_MUNICIPIO_CURSO=="","CO_MUNICIPIO_CURSO"] <- dm_ies[match(cpc3[cpc3$CO_MUNICIPIO_CURSO=="",CO_IES],dm_ies$CO_IES),CO_MUNICIPIO_IES]
cpc3$CHAVE_CURSO_MODALIDADE <- paste0(cpc3$CO_CURSO,"|",cpc3$CO_MUNICIPIO_CURSO,"|",cpc3$CO_MODALIDADE)
cpc3$CHAVE_S_MODALIDADE <- paste0(cpc3$CO_IES,"|",cpc3$CO_GRUPO,"|",cpc3$CO_MUNICIPIO_CURSO)
cpc2[cpc2$NO_MODALIDADE=="Educação Presencial","CO_MODALIDADE"] <- 1
cpc2[cpc2$NO_MODALIDADE=="Educação a Distância","CO_MODALIDADE"] <- 2
cpc2[cpc2$CO_MUNICIPIO_CURSO=="","CO_MUNICIPIO_CURSO"] <- dm_ies[match(cpc2[cpc2$CO_MUNICIPIO_CURSO=="",CO_IES],dm_ies$CO_IES),CO_MUNICIPIO_IES]
cpc2$CHAVE_CURSO_MODALIDADE <- paste0(cpc2$CO_CURSO,"|",cpc2$CO_MUNICIPIO_CURSO,"|",cpc2$CO_MODALIDADE)
cpc2$CHAVE_S_MODALIDADE <- paste0(cpc2$CO_IES,"|",cpc2$CO_GRUPO,"|",cpc2$CO_MUNICIPIO_CURSO)
cpc1[cpc3$NO_MODALIDADE=="Educação Presencial","CO_MODALIDADE"] <- 1
cpc1[cpc3$NO_MODALIDADE=="Educação a Distância","CO_MODALIDADE"] <- 2
cpc1[cpc1$CO_MUNICIPIO_CURSO=="","CO_MUNICIPIO_CURSO"] <- dm_ies[match(cpc1[cpc1$CO_MUNICIPIO_CURSO=="",CO_IES],dm_ies$CO_IES),CO_MUNICIPIO_IES]
cpc1$CHAVE_CURSO_MODALIDADE <- paste0(cpc1$CO_CURSO,"|",cpc1$CO_MUNICIPIO_CURSO,"|",cpc1$CO_MODALIDADE)
cpc1$CHAVE_S_MODALIDADE <- paste0(cpc1$CO_IES,"|",cpc1$CO_GRUPO,"|",cpc1$CO_MUNICIPIO_CURSO)
base_aluno$CPC_FAIXA <- cpc3[match(base_aluno$CHAVE_S_MODALIDADE,cpc3$CHAVE_S_MODALIDADE),CPC_FAIXA]
base_aluno$CPC_CONTINUO <- cpc3[match(base_aluno$CHAVE_S_MODALIDADE,cpc3$CHAVE_S_MODALIDADE),CPC_CONTINUO]
base_aluno$ENADE_BRUTA_FG <- cpc3[match(base_aluno$CHAVE_S_MODALIDADE,cpc3$CHAVE_S_MODALIDADE),BRUTA_FG]
base_aluno$ENADE_BRUTA_CE <- cpc3[match(base_aluno$CHAVE_S_MODALIDADE,cpc3$CHAVE_S_MODALIDADE),BRUTA_CE]
base_aluno$BRUTA_IDD <- cpc3[match(base_aluno$CHAVE_S_MODALIDADE,cpc3$CHAVE_S_MODALIDADE),BRUTA_IDD]
base_aluno$PADRONIZADA_IDD <- cpc3[match(base_aluno$CHAVE_S_MODALIDADE,cpc3$CHAVE_S_MODALIDADE),PADR_IDD]
base_aluno$ENADE_CONTINUA <- cpc3[match(base_aluno$CHAVE_S_MODALIDADE,cpc3$CHAVE_S_MODALIDADE),CONTINUA_ENADE]
base_aluno$CPC_CONTINUO <- cpc3[match(base_aluno$CHAVE_S_MODALIDADE,cpc3$CHAVE_S_MODALIDADE),CPC_CONTINUO]
base_aluno$CPC_FAIXA <- cpc3[match(base_aluno$CHAVE_S_MODALIDADE,cpc3$CHAVE_S_MODALIDADE),CPC_FAIXA]
base_aluno$BRUTA_MESTRES <- cpc3[match(base_aluno$CHAVE_S_MODALIDADE,cpc3$CHAVE_S_MODALIDADE),BRUTA_MESTRES]
base_aluno$PADR_MESTRES <- cpc3[match(base_aluno$CHAVE_S_MODALIDADE,cpc3$CHAVE_S_MODALIDADE),PADR_MESTRES]
base_aluno$BRUTA_DOUTORES <- cpc3[match(base_aluno$CHAVE_S_MODALIDADE,cpc3$CHAVE_S_MODALIDADE),BRUTA_DOUTORES]
base_aluno$PADR_DOUTORES <- cpc3[match(base_aluno$CHAVE_S_MODALIDADE,cpc3$CHAVE_S_MODALIDADE),PADR_DOUTORES]
base_aluno$BRUTA_RT <- cpc3[match(base_aluno$CHAVE_S_MODALIDADE,cpc3$CHAVE_S_MODALIDADE),BRUTA_RT]
base_aluno$PADR_RT <- cpc3[match(base_aluno$CHAVE_S_MODALIDADE,cpc3$CHAVE_S_MODALIDADE),PADR_RT]
base_aluno[is.na(base_aluno$CPC_CONTINUO),"CPC_CONTINUO"] <- cpc2[match(base_aluno[is.na(base_aluno$CPC_CONTINUO),]$CO_CURSO,cpc2$CO_CURSO),CPC_CONTINUO]
base_aluno[is.na(base_aluno$ENADE_BRUTA_FG),"ENADE_BRUTA_FG"] <- cpc2[match(base_aluno[is.na(base_aluno$ENADE_BRUTA_FG),]$CO_CURSO,cpc2$CO_CURSO),BRUTA_FG]
base_aluno[is.na(base_aluno$ENADE_BRUTA_CE),"ENADE_BRUTA_CE"] <- cpc2[match(base_aluno[is.na(base_aluno$ENADE_BRUTA_CE),]$CO_CURSO,cpc2$CO_CURSO),BRUTA_CE]
base_aluno[is.na(base_aluno$BRUTA_IDD),"BRUTA_IDD"] <- cpc2[match(base_aluno[is.na(base_aluno$BRUTA_IDD),]$CO_CURSO,cpc2$CO_CURSO),BRUTA_IDD]
base_aluno[is.na(base_aluno$PADRONIZADA_IDD),"PADRONIZADA_IDD"] <- cpc2[match(base_aluno[is.na(base_aluno$PADRONIZADA_IDD),]$CO_CURSO,cpc2$CO_CURSO),PADR_IDD]
base_aluno[is.na(base_aluno$ENADE_CONTINUA),"ENADE_CONTINUA"] <- cpc2[match(base_aluno[is.na(base_aluno$ENADE_CONTINUA),]$CO_CURSO,cpc2$CO_CURSO),CONTINUA_ENADE]
base_aluno[is.na(base_aluno$CPC_CONTINUO),"CPC_CONTINUO"] <- cpc2[match(base_aluno[is.na(base_aluno$CPC_CONTINUO),]$CO_CURSO,cpc2$CO_CURSO),CPC_CONTINUO]
base_aluno[is.na(base_aluno$CPC_FAIXA),"CPC_FAIXA"] <- cpc2[match(base_aluno[is.na(base_aluno$CPC_FAIXA),]$CO_CURSO,cpc2$CO_CURSO),CPC_FAIXA]
base_aluno[is.na(base_aluno$BRUTA_MESTRES),"BRUTA_MESTRES"] <- cpc2[match(base_aluno[is.na(base_aluno$BRUTA_MESTRES),]$CO_CURSO,cpc2$CO_CURSO),BRUTA_MESTRES]
base_aluno[is.na(base_aluno$PADR_MESTRES),"PADR_MESTRES"] <- cpc2[match(base_aluno[is.na(base_aluno$PADR_MESTRES),]$CO_CURSO,cpc2$CO_CURSO),PADR_MESTRES]
base_aluno[is.na(base_aluno$BRUTA_DOUTORES),"BRUTA_DOUTORES"] <- cpc2[match(base_aluno[is.na(base_aluno$BRUTA_DOUTORES),]$CO_CURSO,cpc2$CO_CURSO),BRUTA_DOUTORES]
base_aluno[is.na(base_aluno$PADR_DOUTORES),"PADR_DOUTORES"] <- cpc2[match(base_aluno[is.na(base_aluno$PADR_DOUTORES),]$CO_CURSO,cpc2$CO_CURSO),PADR_DOUTORES]
base_aluno[is.na(base_aluno$BRUTA_RT),"BRUTA_RT"] <- cpc2[match(base_aluno[is.na(base_aluno$BRUTA_RT),]$CO_CURSO,cpc2$CO_CURSO),BRUTA_RT]
base_aluno[is.na(base_aluno$PADR_RT),"PADR_RT"] <- cpc2[match(base_aluno[is.na(base_aluno$PADR_RT),]$CO_CURSO,cpc2$CO_CURSO),PADR_RT]
base_aluno[is.na(base_aluno$CPC_CONTINUO),"CPC_CONTINUO"] <- cpc1[match(base_aluno[is.na(base_aluno$CPC_CONTINUO),]$CO_CURSO,cpc1$CO_CURSO),CPC_CONTINUO]
base_aluno[is.na(base_aluno$ENADE_BRUTA_FG),"ENADE_BRUTA_FG"] <- cpc1[match(base_aluno[is.na(base_aluno$ENADE_BRUTA_FG),]$CO_CURSO,cpc1$CO_CURSO),BRUTA_FG]
base_aluno[is.na(base_aluno$ENADE_BRUTA_CE),"ENADE_BRUTA_CE"] <- cpc1[match(base_aluno[is.na(base_aluno$ENADE_BRUTA_CE),]$CO_CURSO,cpc1$CO_CURSO),BRUTA_CE]
base_aluno[is.na(base_aluno$BRUTA_IDD),"BRUTA_IDD"] <- cpc1[match(base_aluno[is.na(base_aluno$BRUTA_IDD),]$CO_CURSO,cpc1$CO_CURSO),BRUTA_IDD]
base_aluno[is.na(base_aluno$PADRONIZADA_IDD),"PADRONIZADA_IDD"] <- cpc1[match(base_aluno[is.na(base_aluno$PADRONIZADA_IDD),]$CO_CURSO,cpc1$CO_CURSO),PADR_IDD]
base_aluno[is.na(base_aluno$ENADE_CONTINUA),"ENADE_CONTINUA"] <- cpc1[match(base_aluno[is.na(base_aluno$ENADE_CONTINUA),]$CO_CURSO,cpc1$CO_CURSO),CONTINUA_ENADE]
base_aluno[is.na(base_aluno$CPC_CONTINUO),"CPC_CONTINUO"] <- cpc1[match(base_aluno[is.na(base_aluno$CPC_CONTINUO),]$CO_CURSO,cpc1$CO_CURSO),CPC_CONTINUO]
base_aluno[is.na(base_aluno$CPC_FAIXA),"CPC_FAIXA"] <- cpc1[match(base_aluno[is.na(base_aluno$CPC_FAIXA),]$CO_CURSO,cpc1$CO_CURSO),CPC_FAIXA]
base_aluno[is.na(base_aluno$BRUTA_MESTRES),"BRUTA_MESTRES"] <- cpc1[match(base_aluno[is.na(base_aluno$BRUTA_MESTRES),]$CO_CURSO,cpc1$CO_CURSO),BRUTA_MESTRES]
base_aluno[is.na(base_aluno$PADR_MESTRES),"PADR_MESTRES"] <- cpc1[match(base_aluno[is.na(base_aluno$PADR_MESTRES),]$CO_CURSO,cpc1$CO_CURSO),PADR_MESTRES]
base_aluno[is.na(base_aluno$BRUTA_DOUTORES),"BRUTA_DOUTORES"] <- cpc1[match(base_aluno[is.na(base_aluno$BRUTA_DOUTORES),]$CO_CURSO,cpc1$CO_CURSO),BRUTA_DOUTORES]
base_aluno[is.na(base_aluno$PADR_DOUTORES),"PADR_DOUTORES"] <- cpc1[match(base_aluno[is.na(base_aluno$PADR_DOUTORES),]$CO_CURSO,cpc1$CO_CURSO),PADR_DOUTORES]
base_aluno[is.na(base_aluno$BRUTA_RT),"BRUTA_RT"] <- cpc1[match(base_aluno[is.na(base_aluno$BRUTA_RT),]$CO_CURSO,cpc1$CO_CURSO),BRUTA_RT]
base_aluno[is.na(base_aluno$PADR_RT),"PADR_RT"] <- cpc1[match(base_aluno[is.na(base_aluno$PADR_RT),]$CO_CURSO,cpc1$CO_CURSO),PADR_RT]
base_aluno$IGC_CONTINUO <- igc[match(base_aluno$CO_IES,igc$CO_IES),IGC_CONTINUO]
base_aluno$IGC_FAIXA <- igc[match(base_aluno$CO_IES,igc$CO_IES),IGC_FAIXA]
base_aluno <- base_aluno[c('CHAVE','CHAVE_S_MODALIDADE','CHAVE_CURSO_MUNICIPIO','CO_IES','NO_IES','CO_CURSO','NO_CURSO','CO_GRUPO','NO_GRUPO','CO_MODALIDADE','NO_MODALIDADE','IN_CAPITAL_CURSO','NO_REGIAO_CURSO','CO_MUNICIPIO_CURSO','TOTAL_ALUNO','IN_CONCLUINTE_DM_ALUNO','NU_INGRESSANTES_DM_CURSO','IN_MATRICULA_DM_ALUNO','IN_INGRESSO_TOTAL_DM_ALUNO','NU_VIERAM_ESCOLA_PUBLICA','NU_VIERAM_ESCOLA_PRIVADA','IN_HOMENS','IN_MULHERES','NU_COTA','NU_SEM_COTA','COTA_L1','COTA_L2','COTA_L5','COTA_L6','COTA_L9','COTA_L10','COTA_L13','COTA_L14','COTA_OUTROS','PROUNI_INTEGRAL','PROUNI_PARCIAL','FIES','ENADE_BRUTA_FG','ENADE_BRUTA_CE','ENADE_CONTINUA','CPC_CONTINUO','CPC_FAIXA','IGC_CONTINUO','IGC_FAIXA','BRUTA_MESTRES','PADR_MESTRES','BRUTA_DOUTORES','PADR_DOUTORES','BRUTA_IDD','PADRONIZADA_IDD','BRUTA_RT','PADR_RT')]
write.csv2(paste0(path,"base_aluno_",ano),row.names = F, na = "")
}
save.image(paste0(path,"template pronto.RData"))
base_agregada <- function(ano){
path <- "C:/Users/Matheus/Desktop/Máquina Matheus/Microdados Ensino Superior/Raw Data/"
load("C:/Users/Matheus/Desktop/Máquina Matheus/Microdados Ensino Superior/Raw Data/microdados_censo_superior_",ano,"/DADOS/DM_ALUNO/dm_aluno_",ano,"_char.RData")
dm_curso <- fread(paste0(path,"microdados_censo_superior_",ano,"/DADOS/DM_CURSO/DM_CURSO.CSV"),stringsAsFactors = F, colClasses = "character")
dm_ies <- fread(paste0(path,"microdados_censo_superior_",ano,"/DADOS/DM_IES/DM_IES.CSV"),stringsAsFactors = F, colClasses = "character")
lista_grupos <- fread(paste0(path,"lista_grupos.csv"),stringsAsFactors = F)
cpc3 <- fread(paste0("C:/Users/Matheus/Desktop/Máquina Matheus/CPC/cpc_",ano,".csv"),stringsAsFactors = F)
cpc2 <- fread(paste0("C:/Users/Matheus/Desktop/Máquina Matheus/CPC/cpc_",ano-1,".csv"),stringsAsFactors = F)
cpc1 <- fread(paste0("C:/Users/Matheus/Desktop/Máquina Matheus/CPC/cpc_",ano-2,".csv"),stringsAsFactors = F)
igc <- fread(paste0("C:/Users/Matheus/Desktop/Máquina Matheus/IGC/igc_",ano,".csv"),stringsAsFactors = F)
#Cleaning
dm <- dm[!is.na(dm$CO_GRAU_ACADEMICO),]
gc()
dm <- dm[dm$CO_NIVEL_ACADEMICO==1,]
gc()
dm <- dm[dm$CO_ALUNO_SITUACAO==2,]
gc()
dm$NU_ANO <- ano
dm_curso <- dm_curso[dm_curso$CO_GRAU_ACADEMICO!="" |
!is.na(dm_curso$CO_GRAU_ACADEMICO),]
gc()
dm_curso <- dm_curso[dm_curso$CO_NIVEL_ACADEMICO==1,]
gc()
Sys.sleep(30)
#Merging
dm$CO_MUNICIPIO_CURSO <- dm_curso[match(dm$CO_IES,dm_curso$CO_IES),
"CO_MUNICIPIO_CURSO"]
dm[dm$CO_MUNICIPIO_CURSO=="","CO_MUNICIPIO_CURSO"] <- dm_ies[match(dm[dm$CO_MUNICIPIO_CURSO=="",CO_IES],dm_ies$CO_IES),CO_MUNICIPIO_IES]
dm_curso[dm_curso$CO_MUNICIPIO_CURSO=="","CO_MUNICIPIO_CURSO"] <- dm_ies[match(dm_curso[dm_curso$CO_MUNICIPIO_CURSO=="",CO_IES],dm_ies$CO_IES),CO_MUNICIPIO_IES]
dm$CHAVE_CURSO_MUNICIPIO <- paste0(dm$CO_CURSO,"|",dm$CO_MUNICIPIO_CURSO,"|",
dm$CO_MODALIDADE_ENSINO)
dm_curso$CHAVE_CURSO_MUNICIPIO <- paste0(dm_curso$CO_CURSO,"|",
dm_curso$CO_MUNICIPIO_CURSO,"|",dm_curso$CO_MODALIDADE_ENSINO)
#Criando base agregada
if(ano==2013 | ano==2012) {
base_aluno <- dm %>% group_by(CHAVE_CURSO_MUNICIPIO) %>% summarize(NU_COTA=sum(IN_RESERVA_VAGAS),NU_SEM_COTA=sum(IN_RESERVA_VAGAS==0),
COTA_L1=sum(IN_RESERVA_VAGAS==1 & IN_RESERVA_ETNICO==0 & IN_RESERVA_DEFICIENCIA==0 & IN_RESERVA_ENSINO_PUBLICO==1 & IN_RESERVA_RENDA_FAMILIAR==1 & IN_RESERVA_OUTRA==0),
COTA_L2=sum(IN_RESERVA_VAGAS==1 & IN_RESERVA_ETNICO==1 & IN_RESERVA_DEFICIENCIA==0 & IN_RESERVA_ENSINO_PUBLICO==1 & IN_RESERVA_RENDA_FAMILIAR==1 & IN_RESERVA_OUTRA==0),
COTA_L5=sum(IN_RESERVA_VAGAS==1 & IN_RESERVA_ETNICO==0 & IN_RESERVA_DEFICIENCIA==0 & IN_RESERVA_ENSINO_PUBLICO==1 & IN_RESERVA_RENDA_FAMILIAR==0 & IN_RESERVA_OUTRA==0),
COTA_L6=sum(IN_RESERVA_VAGAS==1 & IN_RESERVA_ETNICO==1 & IN_RESERVA_DEFICIENCIA==0 & IN_RESERVA_ENSINO_PUBLICO==1 & IN_RESERVA_RENDA_FAMILIAR==0 & IN_RESERVA_OUTRA==0),
COTA_L9=sum(IN_RESERVA_VAGAS==1 & IN_RESERVA_ETNICO==0 & IN_RESERVA_DEFICIENCIA==1 & IN_RESERVA_ENSINO_PUBLICO==1 & IN_RESERVA_RENDA_FAMILIAR==1 & IN_RESERVA_OUTRA==0),
COTA_L10=sum(IN_RESERVA_VAGAS==1 & IN_RESERVA_ETNICO==1 & IN_RESERVA_DEFICIENCIA==1 & IN_RESERVA_ENSINO_PUBLICO==1 & IN_RESERVA_RENDA_FAMILIAR==1 & IN_RESERVA_OUTRA==0),
COTA_L13=sum(IN_RESERVA_VAGAS==1 & IN_RESERVA_ETNICO==0 & IN_RESERVA_DEFICIENCIA==1 & IN_RESERVA_ENSINO_PUBLICO==1 & IN_RESERVA_RENDA_FAMILIAR==0 & IN_RESERVA_OUTRA==0),
COTA_L14=sum(IN_RESERVA_VAGAS==1 & IN_RESERVA_ETNICO==1 & IN_RESERVA_DEFICIENCIA==1 & IN_RESERVA_ENSINO_PUBLICO==1 & IN_RESERVA_RENDA_FAMILIAR==0 & IN_RESERVA_OUTRA==0),
COTA_OUTROS=sum(IN_RESERVA_VAGAS==1 & IN_RESERVA_OUTRA==1),
PROUNI_INTEGRAL = sum(IN_FIN_NAOREEMB_PROUNI_INTEGR==1), PROUNI_PARCIAL = sum(IN_FIN_NAOREEMB_PROUNI_PARCIAL==1), FIES = sum(IN_FIN_REEMB_FIES==1),
TOTAL_ALUNO = n(),
NU_VIERAM_ESCOLA_PUBLICA=sum(TP_PROCEDE_EDUC_PUBLICA==1),
NU_VIERAM_ESCOLA_PRIVADA=sum(TP_PROCEDE_EDUC_PUBLICA==0),
IN_HOMENS=sum(IN_SEXO_ALUNO==0),
IN_MULHERES=sum(IN_SEXO_ALUNO==1),
IN_MATRICULA_DM_ALUNO=sum(IN_MATRICULA),
IN_CONCLUINTE_DM_ALUNO=sum(IN_CONCLUINTE),
IN_INGRESSO_TOTAL_DM_ALUNO=sum(IN_INGRESSO_TOTAL))
gc()
} else if(ano==2014 | ano==2015 | ano==2016) {
base_aluno <- dm %>% group_by(CHAVE_CURSO_MUNICIPIO) %>% summarize(NU_COTA=sum(IN_RESERVA_VAGAS),NU_SEM_COTA=sum(IN_RESERVA_VAGAS==0),
COTA_L1=sum(IN_RESERVA_VAGAS==1 & IN_RESERVA_ETNICO==0 & IN_RESERVA_DEFICIENCIA==0 & IN_RESERVA_ENSINO_PUBLICO==1 & IN_RESERVA_RENDA_FAMILIAR==1 & IN_RESERVA_OUTRA==0),
COTA_L2=sum(IN_RESERVA_VAGAS==1 & IN_RESERVA_ETNICO==1 & IN_RESERVA_DEFICIENCIA==0 & IN_RESERVA_ENSINO_PUBLICO==1 & IN_RESERVA_RENDA_FAMILIAR==1 & IN_RESERVA_OUTRA==0),
COTA_L5=sum(IN_RESERVA_VAGAS==1 & IN_RESERVA_ETNICO==0 & IN_RESERVA_DEFICIENCIA==0 & IN_RESERVA_ENSINO_PUBLICO==1 & IN_RESERVA_RENDA_FAMILIAR==0 & IN_RESERVA_OUTRA==0),
COTA_L6=sum(IN_RESERVA_VAGAS==1 & IN_RESERVA_ETNICO==1 & IN_RESERVA_DEFICIENCIA==0 & IN_RESERVA_ENSINO_PUBLICO==1 & IN_RESERVA_RENDA_FAMILIAR==0 & IN_RESERVA_OUTRA==0),
COTA_L9=sum(IN_RESERVA_VAGAS==1 & IN_RESERVA_ETNICO==0 & IN_RESERVA_DEFICIENCIA==1 & IN_RESERVA_ENSINO_PUBLICO==1 & IN_RESERVA_RENDA_FAMILIAR==1 & IN_RESERVA_OUTRA==0),
COTA_L10=sum(IN_RESERVA_VAGAS==1 & IN_RESERVA_ETNICO==1 & IN_RESERVA_DEFICIENCIA==1 & IN_RESERVA_ENSINO_PUBLICO==1 & IN_RESERVA_RENDA_FAMILIAR==1 & IN_RESERVA_OUTRA==0),
COTA_L13=sum(IN_RESERVA_VAGAS==1 & IN_RESERVA_ETNICO==0 & IN_RESERVA_DEFICIENCIA==1 & IN_RESERVA_ENSINO_PUBLICO==1 & IN_RESERVA_RENDA_FAMILIAR==0 & IN_RESERVA_OUTRA==0),
COTA_L14=sum(IN_RESERVA_VAGAS==1 & IN_RESERVA_ETNICO==1 & IN_RESERVA_DEFICIENCIA==1 & IN_RESERVA_ENSINO_PUBLICO==1 & IN_RESERVA_RENDA_FAMILIAR==0 & IN_RESERVA_OUTRA==0),
COTA_OUTROS=sum(IN_RESERVA_VAGAS==1 & IN_RESERVA_OUTRA==1),
PROUNI_INTEGRAL = sum(IN_FIN_NAOREEMB_PROUNI_INTEGR==1), PROUNI_PARCIAL = sum(IN_FIN_NAOREEMB_PROUNI_PARCIAL==1), FIES = sum(IN_FIN_REEMB_FIES==1),
TOTAL_ALUNO = n(),
NU_VIERAM_ESCOLA_PUBLICA=sum(CO_TIPO_ESCOLA_ENS_MEDIO==1),
NU_VIERAM_ESCOLA_PRIVADA=sum(CO_TIPO_ESCOLA_ENS_MEDIO==0),
IN_HOMENS=sum(IN_SEXO_ALUNO==0),
IN_MULHERES=sum(IN_SEXO_ALUNO==1),
IN_MATRICULA_DM_ALUNO=sum(IN_MATRICULA),
IN_CONCLUINTE_DM_ALUNO=sum(IN_CONCLUINTE),
IN_INGRESSO_TOTAL_DM_ALUNO=sum(IN_INGRESSO_TOTAL))
gc()
} else {
print("Ano fora do range")
}
base_aluno <- separate(base_aluno,CHAVE_CURSO_MUNICIPIO,c("CO_CURSO","CO_MUNICIPIO_CURSO","CO_MODALIDADE"))
base_aluno$CHAVE_CURSO_MUNICIPIO <- paste0(base_aluno$CO_CURSO,"|",base_aluno$CO_MUNICIPIO_CURSO,"|",base_aluno$CO_MODALIDADE)
base_curso <- dm_curso %>% group_by(CHAVE_CURSO_MUNICIPIO) %>% summarize(NU_INGRESSANTES_DM_CURSO = sum(as.numeric(QT_INGRESSO_CURSO)))
base_aluno$NU_INGRESSANTES_DM_CURSO <- base_curso[match(base_aluno$CHAVE_CURSO_MUNICIPIO,base_curso$CHAVE_CURSO_MUNICIPIO),"NU_INGRESSANTES_DM_CURSO"]$NU_INGRESSANTES_DM_CURSO
base_aluno$NO_IES <- dm[match(base_aluno$CHAVE_CURSO_MUNICIPIO,dm$CHAVE_CURSO_MUNICIPIO),"NO_IES"]$NO_IES
base_aluno$CO_IES <- dm[match(base_aluno$CHAVE_CURSO_MUNICIPIO,dm$CHAVE_CURSO_MUNICIPIO),"CO_IES"]$CO_IES
base_aluno$NO_CURSO <- dm[match(base_aluno$CHAVE_CURSO_MUNICIPIO,dm$CHAVE_CURSO_MUNICIPIO),"NO_CURSO"]$NO_CURSO
base_aluno$NO_REGIAO_CURSO <- toupper(dm_curso[match(base_aluno$CO_CURSO,dm_curso$CO_CURSO),"NO_REGIAO_CURSO"]$NO_REGIAO_CURSO)
base_aluno$NO_MODALIDADE <- toupper(dm_curso[match(base_aluno$CO_CURSO,dm_curso$CO_CURSO),"DS_MODALIDADE_ENSINO"]$DS_MODALIDADE_ENSINO)
base_aluno[base_aluno$CO_MODALIDADE=="2","IN_CAPITAL_CURSO"] <- ""
base_aluno[is.na(base_aluno$IN_CAPITAL_CURSO),"IN_CAPITAL_CURSO"] <- dm_curso[match(base_aluno[is.na(base_aluno$IN_CAPITAL_CURSO),]$CO_CURSO,dm_curso$CO_CURSO),IN_CAPITAL_CURSO]
base_aluno[base_aluno$IN_CAPITAL_CURSO=="","IN_CAPITAL_CURSO"] <- "EAD"
base_aluno[base_aluno$IN_CAPITAL_CURSO=="1","IN_CAPITAL_CURSO"] <- "CAPITAL"
base_aluno[base_aluno$IN_CAPITAL_CURSO=="0","IN_CAPITAL_CURSO"] <- "INTERIOR"
base_aluno$CO_GRUPO <- lista_grupos[match(base_aluno$CO_CURSO,lista_grupos$CO_CURSO),CO_GRUPO]
base_aluno$NO_GRUPO <- lista_grupos[match(base_aluno$CO_CURSO,lista_grupos$CO_CURSO),NO_GRUPO]
base_aluno$CHAVE_S_MODALIDADE <- paste0(base_aluno$CO_IES,"|",base_aluno$CO_GRUPO,"|",base_aluno$CO_MUNICIPIO_CURSO)
base_aluno$CHAVE <- paste0(ano,"|",base_aluno$CO_IES,"|",base_aluno$CO_GRUPO,"|",base_aluno$CO_MUNICIPIO_CURSO,"|",base_aluno$CO_MODALIDADE)
cpc3[cpc3$NO_MODALIDADE=="Educação Presencial","CO_MODALIDADE"] <- 1
cpc3[cpc3$NO_MODALIDADE=="Educação a Distância","CO_MODALIDADE"] <- 2
cpc3[cpc3$CO_MUNICIPIO_CURSO=="","CO_MUNICIPIO_CURSO"] <- dm_ies[match(cpc3[cpc3$CO_MUNICIPIO_CURSO=="",CO_IES],dm_ies$CO_IES),CO_MUNICIPIO_IES]
cpc3$CHAVE_CURSO_MODALIDADE <- paste0(cpc3$CO_CURSO,"|",cpc3$CO_MUNICIPIO_CURSO,"|",cpc3$CO_MODALIDADE)
cpc3$CHAVE_S_MODALIDADE <- paste0(cpc3$CO_IES,"|",cpc3$CO_GRUPO,"|",cpc3$CO_MUNICIPIO_CURSO)
cpc2[cpc2$NO_MODALIDADE=="Educação Presencial","CO_MODALIDADE"] <- 1
cpc2[cpc2$NO_MODALIDADE=="Educação a Distância","CO_MODALIDADE"] <- 2
cpc2[cpc2$CO_MUNICIPIO_CURSO=="","CO_MUNICIPIO_CURSO"] <- dm_ies[match(cpc2[cpc2$CO_MUNICIPIO_CURSO=="",CO_IES],dm_ies$CO_IES),CO_MUNICIPIO_IES]
cpc2$CHAVE_CURSO_MODALIDADE <- paste0(cpc2$CO_CURSO,"|",cpc2$CO_MUNICIPIO_CURSO,"|",cpc2$CO_MODALIDADE)
cpc2$CHAVE_S_MODALIDADE <- paste0(cpc2$CO_IES,"|",cpc2$CO_GRUPO,"|",cpc2$CO_MUNICIPIO_CURSO)
cpc1[cpc3$NO_MODALIDADE=="Educação Presencial","CO_MODALIDADE"] <- 1
cpc1[cpc3$NO_MODALIDADE=="Educação a Distância","CO_MODALIDADE"] <- 2
cpc1[cpc1$CO_MUNICIPIO_CURSO=="","CO_MUNICIPIO_CURSO"] <- dm_ies[match(cpc1[cpc1$CO_MUNICIPIO_CURSO=="",CO_IES],dm_ies$CO_IES),CO_MUNICIPIO_IES]
cpc1$CHAVE_CURSO_MODALIDADE <- paste0(cpc1$CO_CURSO,"|",cpc1$CO_MUNICIPIO_CURSO,"|",cpc1$CO_MODALIDADE)
cpc1$CHAVE_S_MODALIDADE <- paste0(cpc1$CO_IES,"|",cpc1$CO_GRUPO,"|",cpc1$CO_MUNICIPIO_CURSO)
base_aluno$CPC_FAIXA <- cpc3[match(base_aluno$CHAVE_S_MODALIDADE,cpc3$CHAVE_S_MODALIDADE),CPC_FAIXA]
base_aluno$CPC_CONTINUO <- cpc3[match(base_aluno$CHAVE_S_MODALIDADE,cpc3$CHAVE_S_MODALIDADE),CPC_CONTINUO]
base_aluno$ENADE_BRUTA_FG <- cpc3[match(base_aluno$CHAVE_S_MODALIDADE,cpc3$CHAVE_S_MODALIDADE),BRUTA_FG]
base_aluno$ENADE_BRUTA_CE <- cpc3[match(base_aluno$CHAVE_S_MODALIDADE,cpc3$CHAVE_S_MODALIDADE),BRUTA_CE]
base_aluno$BRUTA_IDD <- cpc3[match(base_aluno$CHAVE_S_MODALIDADE,cpc3$CHAVE_S_MODALIDADE),BRUTA_IDD]
base_aluno$PADRONIZADA_IDD <- cpc3[match(base_aluno$CHAVE_S_MODALIDADE,cpc3$CHAVE_S_MODALIDADE),PADR_IDD]
base_aluno$ENADE_CONTINUA <- cpc3[match(base_aluno$CHAVE_S_MODALIDADE,cpc3$CHAVE_S_MODALIDADE),CONTINUA_ENADE]
base_aluno$CPC_CONTINUO <- cpc3[match(base_aluno$CHAVE_S_MODALIDADE,cpc3$CHAVE_S_MODALIDADE),CPC_CONTINUO]
base_aluno$CPC_FAIXA <- cpc3[match(base_aluno$CHAVE_S_MODALIDADE,cpc3$CHAVE_S_MODALIDADE),CPC_FAIXA]
base_aluno$BRUTA_MESTRES <- cpc3[match(base_aluno$CHAVE_S_MODALIDADE,cpc3$CHAVE_S_MODALIDADE),BRUTA_MESTRES]
base_aluno$PADR_MESTRES <- cpc3[match(base_aluno$CHAVE_S_MODALIDADE,cpc3$CHAVE_S_MODALIDADE),PADR_MESTRES]
base_aluno$BRUTA_DOUTORES <- cpc3[match(base_aluno$CHAVE_S_MODALIDADE,cpc3$CHAVE_S_MODALIDADE),BRUTA_DOUTORES]
base_aluno$PADR_DOUTORES <- cpc3[match(base_aluno$CHAVE_S_MODALIDADE,cpc3$CHAVE_S_MODALIDADE),PADR_DOUTORES]
base_aluno$BRUTA_RT <- cpc3[match(base_aluno$CHAVE_S_MODALIDADE,cpc3$CHAVE_S_MODALIDADE),BRUTA_RT]
base_aluno$PADR_RT <- cpc3[match(base_aluno$CHAVE_S_MODALIDADE,cpc3$CHAVE_S_MODALIDADE),PADR_RT]
base_aluno[is.na(base_aluno$CPC_CONTINUO),"CPC_CONTINUO"] <- cpc2[match(base_aluno[is.na(base_aluno$CPC_CONTINUO),]$CO_CURSO,cpc2$CO_CURSO),CPC_CONTINUO]
base_aluno[is.na(base_aluno$ENADE_BRUTA_FG),"ENADE_BRUTA_FG"] <- cpc2[match(base_aluno[is.na(base_aluno$ENADE_BRUTA_FG),]$CO_CURSO,cpc2$CO_CURSO),BRUTA_FG]
base_aluno[is.na(base_aluno$ENADE_BRUTA_CE),"ENADE_BRUTA_CE"] <- cpc2[match(base_aluno[is.na(base_aluno$ENADE_BRUTA_CE),]$CO_CURSO,cpc2$CO_CURSO),BRUTA_CE]
base_aluno[is.na(base_aluno$BRUTA_IDD),"BRUTA_IDD"] <- cpc2[match(base_aluno[is.na(base_aluno$BRUTA_IDD),]$CO_CURSO,cpc2$CO_CURSO),BRUTA_IDD]
base_aluno[is.na(base_aluno$PADRONIZADA_IDD),"PADRONIZADA_IDD"] <- cpc2[match(base_aluno[is.na(base_aluno$PADRONIZADA_IDD),]$CO_CURSO,cpc2$CO_CURSO),PADR_IDD]
base_aluno[is.na(base_aluno$ENADE_CONTINUA),"ENADE_CONTINUA"] <- cpc2[match(base_aluno[is.na(base_aluno$ENADE_CONTINUA),]$CO_CURSO,cpc2$CO_CURSO),CONTINUA_ENADE]
base_aluno[is.na(base_aluno$CPC_CONTINUO),"CPC_CONTINUO"] <- cpc2[match(base_aluno[is.na(base_aluno$CPC_CONTINUO),]$CO_CURSO,cpc2$CO_CURSO),CPC_CONTINUO]
base_aluno[is.na(base_aluno$CPC_FAIXA),"CPC_FAIXA"] <- cpc2[match(base_aluno[is.na(base_aluno$CPC_FAIXA),]$CO_CURSO,cpc2$CO_CURSO),CPC_FAIXA]
base_aluno[is.na(base_aluno$BRUTA_MESTRES),"BRUTA_MESTRES"] <- cpc2[match(base_aluno[is.na(base_aluno$BRUTA_MESTRES),]$CO_CURSO,cpc2$CO_CURSO),BRUTA_MESTRES]
base_aluno[is.na(base_aluno$PADR_MESTRES),"PADR_MESTRES"] <- cpc2[match(base_aluno[is.na(base_aluno$PADR_MESTRES),]$CO_CURSO,cpc2$CO_CURSO),PADR_MESTRES]
base_aluno[is.na(base_aluno$BRUTA_DOUTORES),"BRUTA_DOUTORES"] <- cpc2[match(base_aluno[is.na(base_aluno$BRUTA_DOUTORES),]$CO_CURSO,cpc2$CO_CURSO),BRUTA_DOUTORES]
base_aluno[is.na(base_aluno$PADR_DOUTORES),"PADR_DOUTORES"] <- cpc2[match(base_aluno[is.na(base_aluno$PADR_DOUTORES),]$CO_CURSO,cpc2$CO_CURSO),PADR_DOUTORES]
base_aluno[is.na(base_aluno$BRUTA_RT),"BRUTA_RT"] <- cpc2[match(base_aluno[is.na(base_aluno$BRUTA_RT),]$CO_CURSO,cpc2$CO_CURSO),BRUTA_RT]
base_aluno[is.na(base_aluno$PADR_RT),"PADR_RT"] <- cpc2[match(base_aluno[is.na(base_aluno$PADR_RT),]$CO_CURSO,cpc2$CO_CURSO),PADR_RT]
base_aluno[is.na(base_aluno$CPC_CONTINUO),"CPC_CONTINUO"] <- cpc1[match(base_aluno[is.na(base_aluno$CPC_CONTINUO),]$CO_CURSO,cpc1$CO_CURSO),CPC_CONTINUO]
base_aluno[is.na(base_aluno$ENADE_BRUTA_FG),"ENADE_BRUTA_FG"] <- cpc1[match(base_aluno[is.na(base_aluno$ENADE_BRUTA_FG),]$CO_CURSO,cpc1$CO_CURSO),BRUTA_FG]
base_aluno[is.na(base_aluno$ENADE_BRUTA_CE),"ENADE_BRUTA_CE"] <- cpc1[match(base_aluno[is.na(base_aluno$ENADE_BRUTA_CE),]$CO_CURSO,cpc1$CO_CURSO),BRUTA_CE]
base_aluno[is.na(base_aluno$BRUTA_IDD),"BRUTA_IDD"] <- cpc1[match(base_aluno[is.na(base_aluno$BRUTA_IDD),]$CO_CURSO,cpc1$CO_CURSO),BRUTA_IDD]
base_aluno[is.na(base_aluno$PADRONIZADA_IDD),"PADRONIZADA_IDD"] <- cpc1[match(base_aluno[is.na(base_aluno$PADRONIZADA_IDD),]$CO_CURSO,cpc1$CO_CURSO),PADR_IDD]
base_aluno[is.na(base_aluno$ENADE_CONTINUA),"ENADE_CONTINUA"] <- cpc1[match(base_aluno[is.na(base_aluno$ENADE_CONTINUA),]$CO_CURSO,cpc1$CO_CURSO),CONTINUA_ENADE]
base_aluno[is.na(base_aluno$CPC_CONTINUO),"CPC_CONTINUO"] <- cpc1[match(base_aluno[is.na(base_aluno$CPC_CONTINUO),]$CO_CURSO,cpc1$CO_CURSO),CPC_CONTINUO]
base_aluno[is.na(base_aluno$CPC_FAIXA),"CPC_FAIXA"] <- cpc1[match(base_aluno[is.na(base_aluno$CPC_FAIXA),]$CO_CURSO,cpc1$CO_CURSO),CPC_FAIXA]
base_aluno[is.na(base_aluno$BRUTA_MESTRES),"BRUTA_MESTRES"] <- cpc1[match(base_aluno[is.na(base_aluno$BRUTA_MESTRES),]$CO_CURSO,cpc1$CO_CURSO),BRUTA_MESTRES]
base_aluno[is.na(base_aluno$PADR_MESTRES),"PADR_MESTRES"] <- cpc1[match(base_aluno[is.na(base_aluno$PADR_MESTRES),]$CO_CURSO,cpc1$CO_CURSO),PADR_MESTRES]
base_aluno[is.na(base_aluno$BRUTA_DOUTORES),"BRUTA_DOUTORES"] <- cpc1[match(base_aluno[is.na(base_aluno$BRUTA_DOUTORES),]$CO_CURSO,cpc1$CO_CURSO),BRUTA_DOUTORES]
base_aluno[is.na(base_aluno$PADR_DOUTORES),"PADR_DOUTORES"] <- cpc1[match(base_aluno[is.na(base_aluno$PADR_DOUTORES),]$CO_CURSO,cpc1$CO_CURSO),PADR_DOUTORES]
base_aluno[is.na(base_aluno$BRUTA_RT),"BRUTA_RT"] <- cpc1[match(base_aluno[is.na(base_aluno$BRUTA_RT),]$CO_CURSO,cpc1$CO_CURSO),BRUTA_RT]
base_aluno[is.na(base_aluno$PADR_RT),"PADR_RT"] <- cpc1[match(base_aluno[is.na(base_aluno$PADR_RT),]$CO_CURSO,cpc1$CO_CURSO),PADR_RT]
base_aluno$IGC_CONTINUO <- igc[match(base_aluno$CO_IES,igc$CO_IES),IGC_CONTINUO]
base_aluno$IGC_FAIXA <- igc[match(base_aluno$CO_IES,igc$CO_IES),IGC_FAIXA]
base_aluno <- base_aluno[c('CHAVE','CHAVE_S_MODALIDADE','CHAVE_CURSO_MUNICIPIO','CO_IES','NO_IES','CO_CURSO','NO_CURSO','CO_GRUPO','NO_GRUPO','CO_MODALIDADE','NO_MODALIDADE','IN_CAPITAL_CURSO','NO_REGIAO_CURSO','CO_MUNICIPIO_CURSO','TOTAL_ALUNO','IN_CONCLUINTE_DM_ALUNO','NU_INGRESSANTES_DM_CURSO','IN_MATRICULA_DM_ALUNO','IN_INGRESSO_TOTAL_DM_ALUNO','NU_VIERAM_ESCOLA_PUBLICA','NU_VIERAM_ESCOLA_PRIVADA','IN_HOMENS','IN_MULHERES','NU_COTA','NU_SEM_COTA','COTA_L1','COTA_L2','COTA_L5','COTA_L6','COTA_L9','COTA_L10','COTA_L13','COTA_L14','COTA_OUTROS','PROUNI_INTEGRAL','PROUNI_PARCIAL','FIES','ENADE_BRUTA_FG','ENADE_BRUTA_CE','ENADE_CONTINUA','CPC_CONTINUO','CPC_FAIXA','IGC_CONTINUO','IGC_FAIXA','BRUTA_MESTRES','PADR_MESTRES','BRUTA_DOUTORES','PADR_DOUTORES','BRUTA_IDD','PADRONIZADA_IDD','BRUTA_RT','PADR_RT')]
write.csv2(paste0(path,"base_aluno_",ano),row.names = F, na = "")
gc()
rm(list = ls(all=T))
Sys.sleep(120)
}
base_agregada <- function(ano){
#Loading
print(paste0("Carregando Base ",ano))
path <- "C:/Users/Matheus/Desktop/Máquina Matheus/Microdados Ensino Superior/Raw Data/"
load("C:/Users/Matheus/Desktop/Máquina Matheus/Microdados Ensino Superior/Raw Data/microdados_censo_superior_",ano,"/DADOS/DM_ALUNO/dm_aluno_",ano,"_char.RData")
dm_curso <- fread(paste0(path,"microdados_censo_superior_",ano,"/DADOS/DM_CURSO/DM_CURSO.CSV"),stringsAsFactors = F, colClasses = "character")
dm_ies <- fread(paste0(path,"microdados_censo_superior_",ano,"/DADOS/DM_IES/DM_IES.CSV"),stringsAsFactors = F, colClasses = "character")
lista_grupos <- fread(paste0(path,"lista_grupos.csv"),stringsAsFactors = F)
cpc3 <- fread(paste0("C:/Users/Matheus/Desktop/Máquina Matheus/CPC/cpc_",ano,".csv"),stringsAsFactors = F)
cpc2 <- fread(paste0("C:/Users/Matheus/Desktop/Máquina Matheus/CPC/cpc_",ano-1,".csv"),stringsAsFactors = F)
cpc1 <- fread(paste0("C:/Users/Matheus/Desktop/Máquina Matheus/CPC/cpc_",ano-2,".csv"),stringsAsFactors = F)
igc <- fread(paste0("C:/Users/Matheus/Desktop/Máquina Matheus/IGC/igc_",ano,".csv"),stringsAsFactors = F)
#Cleaning
print("Filtrando Base")
dm <- dm[!is.na(dm$CO_GRAU_ACADEMICO),]
gc()
dm <- dm[dm$CO_NIVEL_ACADEMICO==1,]
gc()
dm <- dm[dm$CO_ALUNO_SITUACAO==2,]
gc()
dm$NU_ANO <- ano
dm_curso <- dm_curso[dm_curso$CO_GRAU_ACADEMICO!="" |
!is.na(dm_curso$CO_GRAU_ACADEMICO),]
gc()
dm_curso <- dm_curso[dm_curso$CO_NIVEL_ACADEMICO==1,]
gc()
Sys.sleep(30)
#Merging
print("Match entre bases")
dm$CO_MUNICIPIO_CURSO <- dm_curso[match(dm$CO_IES,dm_curso$CO_IES),
"CO_MUNICIPIO_CURSO"]
dm[dm$CO_MUNICIPIO_CURSO=="","CO_MUNICIPIO_CURSO"] <- dm_ies[match(dm[dm$CO_MUNICIPIO_CURSO=="",CO_IES],dm_ies$CO_IES),CO_MUNICIPIO_IES]
dm_curso[dm_curso$CO_MUNICIPIO_CURSO=="","CO_MUNICIPIO_CURSO"] <- dm_ies[match(dm_curso[dm_curso$CO_MUNICIPIO_CURSO=="",CO_IES],dm_ies$CO_IES),CO_MUNICIPIO_IES]
dm$CHAVE_CURSO_MUNICIPIO <- paste0(dm$CO_CURSO,"|",dm$CO_MUNICIPIO_CURSO,"|",
dm$CO_MODALIDADE_ENSINO)
dm_curso$CHAVE_CURSO_MUNICIPIO <- paste0(dm_curso$CO_CURSO,"|",
dm_curso$CO_MUNICIPIO_CURSO,"|",dm_curso$CO_MODALIDADE_ENSINO)
#Criando base agregada
print("Criando base agregada")
if(ano==2013 | ano==2012) {
base_aluno <- dm %>% group_by(CHAVE_CURSO_MUNICIPIO) %>% summarize(NU_COTA=sum(IN_RESERVA_VAGAS),NU_SEM_COTA=sum(IN_RESERVA_VAGAS==0),
COTA_L1=sum(IN_RESERVA_VAGAS==1 & IN_RESERVA_ETNICO==0 & IN_RESERVA_DEFICIENCIA==0 & IN_RESERVA_ENSINO_PUBLICO==1 & IN_RESERVA_RENDA_FAMILIAR==1 & IN_RESERVA_OUTRA==0),
COTA_L2=sum(IN_RESERVA_VAGAS==1 & IN_RESERVA_ETNICO==1 & IN_RESERVA_DEFICIENCIA==0 & IN_RESERVA_ENSINO_PUBLICO==1 & IN_RESERVA_RENDA_FAMILIAR==1 & IN_RESERVA_OUTRA==0),
COTA_L5=sum(IN_RESERVA_VAGAS==1 & IN_RESERVA_ETNICO==0 & IN_RESERVA_DEFICIENCIA==0 & IN_RESERVA_ENSINO_PUBLICO==1 & IN_RESERVA_RENDA_FAMILIAR==0 & IN_RESERVA_OUTRA==0),
COTA_L6=sum(IN_RESERVA_VAGAS==1 & IN_RESERVA_ETNICO==1 & IN_RESERVA_DEFICIENCIA==0 & IN_RESERVA_ENSINO_PUBLICO==1 & IN_RESERVA_RENDA_FAMILIAR==0 & IN_RESERVA_OUTRA==0),
COTA_L9=sum(IN_RESERVA_VAGAS==1 & IN_RESERVA_ETNICO==0 & IN_RESERVA_DEFICIENCIA==1 & IN_RESERVA_ENSINO_PUBLICO==1 & IN_RESERVA_RENDA_FAMILIAR==1 & IN_RESERVA_OUTRA==0),
COTA_L10=sum(IN_RESERVA_VAGAS==1 & IN_RESERVA_ETNICO==1 & IN_RESERVA_DEFICIENCIA==1 & IN_RESERVA_ENSINO_PUBLICO==1 & IN_RESERVA_RENDA_FAMILIAR==1 & IN_RESERVA_OUTRA==0),
COTA_L13=sum(IN_RESERVA_VAGAS==1 & IN_RESERVA_ETNICO==0 & IN_RESERVA_DEFICIENCIA==1 & IN_RESERVA_ENSINO_PUBLICO==1 & IN_RESERVA_RENDA_FAMILIAR==0 & IN_RESERVA_OUTRA==0),
COTA_L14=sum(IN_RESERVA_VAGAS==1 & IN_RESERVA_ETNICO==1 & IN_RESERVA_DEFICIENCIA==1 & IN_RESERVA_ENSINO_PUBLICO==1 & IN_RESERVA_RENDA_FAMILIAR==0 & IN_RESERVA_OUTRA==0),
COTA_OUTROS=sum(IN_RESERVA_VAGAS==1 & IN_RESERVA_OUTRA==1),
PROUNI_INTEGRAL = sum(IN_FIN_NAOREEMB_PROUNI_INTEGR==1), PROUNI_PARCIAL = sum(IN_FIN_NAOREEMB_PROUNI_PARCIAL==1), FIES = sum(IN_FIN_REEMB_FIES==1),
TOTAL_ALUNO = n(),
NU_VIERAM_ESCOLA_PUBLICA=sum(TP_PROCEDE_EDUC_PUBLICA==1),
NU_VIERAM_ESCOLA_PRIVADA=sum(TP_PROCEDE_EDUC_PUBLICA==0),
IN_HOMENS=sum(IN_SEXO_ALUNO==0),
IN_MULHERES=sum(IN_SEXO_ALUNO==1),
IN_MATRICULA_DM_ALUNO=sum(IN_MATRICULA),
IN_CONCLUINTE_DM_ALUNO=sum(IN_CONCLUINTE),
IN_INGRESSO_TOTAL_DM_ALUNO=sum(IN_INGRESSO_TOTAL))
gc()
} else if(ano==2014 | ano==2015 | ano==2016) {
base_aluno <- dm %>% group_by(CHAVE_CURSO_MUNICIPIO) %>% summarize(NU_COTA=sum(IN_RESERVA_VAGAS),NU_SEM_COTA=sum(IN_RESERVA_VAGAS==0),
COTA_L1=sum(IN_RESERVA_VAGAS==1 & IN_RESERVA_ETNICO==0 & IN_RESERVA_DEFICIENCIA==0 & IN_RESERVA_ENSINO_PUBLICO==1 & IN_RESERVA_RENDA_FAMILIAR==1 & IN_RESERVA_OUTRA==0),
COTA_L2=sum(IN_RESERVA_VAGAS==1 & IN_RESERVA_ETNICO==1 & IN_RESERVA_DEFICIENCIA==0 & IN_RESERVA_ENSINO_PUBLICO==1 & IN_RESERVA_RENDA_FAMILIAR==1 & IN_RESERVA_OUTRA==0),
COTA_L5=sum(IN_RESERVA_VAGAS==1 & IN_RESERVA_ETNICO==0 & IN_RESERVA_DEFICIENCIA==0 & IN_RESERVA_ENSINO_PUBLICO==1 & IN_RESERVA_RENDA_FAMILIAR==0 & IN_RESERVA_OUTRA==0),
COTA_L6=sum(IN_RESERVA_VAGAS==1 & IN_RESERVA_ETNICO==1 & IN_RESERVA_DEFICIENCIA==0 & IN_RESERVA_ENSINO_PUBLICO==1 & IN_RESERVA_RENDA_FAMILIAR==0 & IN_RESERVA_OUTRA==0),
COTA_L9=sum(IN_RESERVA_VAGAS==1 & IN_RESERVA_ETNICO==0 & IN_RESERVA_DEFICIENCIA==1 & IN_RESERVA_ENSINO_PUBLICO==1 & IN_RESERVA_RENDA_FAMILIAR==1 & IN_RESERVA_OUTRA==0),
COTA_L10=sum(IN_RESERVA_VAGAS==1 & IN_RESERVA_ETNICO==1 & IN_RESERVA_DEFICIENCIA==1 & IN_RESERVA_ENSINO_PUBLICO==1 & IN_RESERVA_RENDA_FAMILIAR==1 & IN_RESERVA_OUTRA==0),
COTA_L13=sum(IN_RESERVA_VAGAS==1 & IN_RESERVA_ETNICO==0 & IN_RESERVA_DEFICIENCIA==1 & IN_RESERVA_ENSINO_PUBLICO==1 & IN_RESERVA_RENDA_FAMILIAR==0 & IN_RESERVA_OUTRA==0),
COTA_L14=sum(IN_RESERVA_VAGAS==1 & IN_RESERVA_ETNICO==1 & IN_RESERVA_DEFICIENCIA==1 & IN_RESERVA_ENSINO_PUBLICO==1 & IN_RESERVA_RENDA_FAMILIAR==0 & IN_RESERVA_OUTRA==0),
COTA_OUTROS=sum(IN_RESERVA_VAGAS==1 & IN_RESERVA_OUTRA==1),
PROUNI_INTEGRAL = sum(IN_FIN_NAOREEMB_PROUNI_INTEGR==1), PROUNI_PARCIAL = sum(IN_FIN_NAOREEMB_PROUNI_PARCIAL==1), FIES = sum(IN_FIN_REEMB_FIES==1),
TOTAL_ALUNO = n(),
NU_VIERAM_ESCOLA_PUBLICA=sum(CO_TIPO_ESCOLA_ENS_MEDIO==1),
NU_VIERAM_ESCOLA_PRIVADA=sum(CO_TIPO_ESCOLA_ENS_MEDIO==0),
IN_HOMENS=sum(IN_SEXO_ALUNO==0),
IN_MULHERES=sum(IN_SEXO_ALUNO==1),
IN_MATRICULA_DM_ALUNO=sum(IN_MATRICULA),
IN_CONCLUINTE_DM_ALUNO=sum(IN_CONCLUINTE),
IN_INGRESSO_TOTAL_DM_ALUNO=sum(IN_INGRESSO_TOTAL))
gc()
} else {
print("Ano fora do range")
}
base_aluno <- separate(base_aluno,CHAVE_CURSO_MUNICIPIO,c("CO_CURSO","CO_MUNICIPIO_CURSO","CO_MODALIDADE"))
base_aluno$CHAVE_CURSO_MUNICIPIO <- paste0(base_aluno$CO_CURSO,"|",base_aluno$CO_MUNICIPIO_CURSO,"|",base_aluno$CO_MODALIDADE)
base_curso <- dm_curso %>% group_by(CHAVE_CURSO_MUNICIPIO) %>% summarize(NU_INGRESSANTES_DM_CURSO = sum(as.numeric(QT_INGRESSO_CURSO)))
base_aluno$NU_INGRESSANTES_DM_CURSO <- base_curso[match(base_aluno$CHAVE_CURSO_MUNICIPIO,base_curso$CHAVE_CURSO_MUNICIPIO),"NU_INGRESSANTES_DM_CURSO"]$NU_INGRESSANTES_DM_CURSO
base_aluno$NO_IES <- dm[match(base_aluno$CHAVE_CURSO_MUNICIPIO,dm$CHAVE_CURSO_MUNICIPIO),"NO_IES"]$NO_IES
base_aluno$CO_IES <- dm[match(base_aluno$CHAVE_CURSO_MUNICIPIO,dm$CHAVE_CURSO_MUNICIPIO),"CO_IES"]$CO_IES
base_aluno$NO_CURSO <- dm[match(base_aluno$CHAVE_CURSO_MUNICIPIO,dm$CHAVE_CURSO_MUNICIPIO),"NO_CURSO"]$NO_CURSO
base_aluno$NO_REGIAO_CURSO <- toupper(dm_curso[match(base_aluno$CO_CURSO,dm_curso$CO_CURSO),"NO_REGIAO_CURSO"]$NO_REGIAO_CURSO)
base_aluno$NO_MODALIDADE <- toupper(dm_curso[match(base_aluno$CO_CURSO,dm_curso$CO_CURSO),"DS_MODALIDADE_ENSINO"]$DS_MODALIDADE_ENSINO)
base_aluno[base_aluno$CO_MODALIDADE=="2","IN_CAPITAL_CURSO"] <- ""
base_aluno[is.na(base_aluno$IN_CAPITAL_CURSO),"IN_CAPITAL_CURSO"] <- dm_curso[match(base_aluno[is.na(base_aluno$IN_CAPITAL_CURSO),]$CO_CURSO,dm_curso$CO_CURSO),IN_CAPITAL_CURSO]
base_aluno[base_aluno$IN_CAPITAL_CURSO=="","IN_CAPITAL_CURSO"] <- "EAD"
base_aluno[base_aluno$IN_CAPITAL_CURSO=="1","IN_CAPITAL_CURSO"] <- "CAPITAL"
base_aluno[base_aluno$IN_CAPITAL_CURSO=="0","IN_CAPITAL_CURSO"] <- "INTERIOR"
base_aluno$CO_GRUPO <- lista_grupos[match(base_aluno$CO_CURSO,lista_grupos$CO_CURSO),CO_GRUPO]
base_aluno$NO_GRUPO <- lista_grupos[match(base_aluno$CO_CURSO,lista_grupos$CO_CURSO),NO_GRUPO]
base_aluno$CHAVE_S_MODALIDADE <- paste0(base_aluno$CO_IES,"|",base_aluno$CO_GRUPO,"|",base_aluno$CO_MUNICIPIO_CURSO)
base_aluno$CHAVE <- paste0(ano,"|",base_aluno$CO_IES,"|",base_aluno$CO_GRUPO,"|",base_aluno$CO_MUNICIPIO_CURSO,"|",base_aluno$CO_MODALIDADE)
print("Inclusão de indicadores")
cpc3[cpc3$NO_MODALIDADE=="Educação Presencial","CO_MODALIDADE"] <- 1
cpc3[cpc3$NO_MODALIDADE=="Educação a Distância","CO_MODALIDADE"] <- 2
cpc3[cpc3$CO_MUNICIPIO_CURSO=="","CO_MUNICIPIO_CURSO"] <- dm_ies[match(cpc3[cpc3$CO_MUNICIPIO_CURSO=="",CO_IES],dm_ies$CO_IES),CO_MUNICIPIO_IES]
cpc3$CHAVE_CURSO_MODALIDADE <- paste0(cpc3$CO_CURSO,"|",cpc3$CO_MUNICIPIO_CURSO,"|",cpc3$CO_MODALIDADE)
cpc3$CHAVE_S_MODALIDADE <- paste0(cpc3$CO_IES,"|",cpc3$CO_GRUPO,"|",cpc3$CO_MUNICIPIO_CURSO)
cpc2[cpc2$NO_MODALIDADE=="Educação Presencial","CO_MODALIDADE"] <- 1
cpc2[cpc2$NO_MODALIDADE=="Educação a Distância","CO_MODALIDADE"] <- 2
cpc2[cpc2$CO_MUNICIPIO_CURSO=="","CO_MUNICIPIO_CURSO"] <- dm_ies[match(cpc2[cpc2$CO_MUNICIPIO_CURSO=="",CO_IES],dm_ies$CO_IES),CO_MUNICIPIO_IES]
cpc2$CHAVE_CURSO_MODALIDADE <- paste0(cpc2$CO_CURSO,"|",cpc2$CO_MUNICIPIO_CURSO,"|",cpc2$CO_MODALIDADE)
cpc2$CHAVE_S_MODALIDADE <- paste0(cpc2$CO_IES,"|",cpc2$CO_GRUPO,"|",cpc2$CO_MUNICIPIO_CURSO)
cpc1[cpc3$NO_MODALIDADE=="Educação Presencial","CO_MODALIDADE"] <- 1
cpc1[cpc3$NO_MODALIDADE=="Educação a Distância","CO_MODALIDADE"] <- 2
cpc1[cpc1$CO_MUNICIPIO_CURSO=="","CO_MUNICIPIO_CURSO"] <- dm_ies[match(cpc1[cpc1$CO_MUNICIPIO_CURSO=="",CO_IES],dm_ies$CO_IES),CO_MUNICIPIO_IES]
cpc1$CHAVE_CURSO_MODALIDADE <- paste0(cpc1$CO_CURSO,"|",cpc1$CO_MUNICIPIO_CURSO,"|",cpc1$CO_MODALIDADE)
cpc1$CHAVE_S_MODALIDADE <- paste0(cpc1$CO_IES,"|",cpc1$CO_GRUPO,"|",cpc1$CO_MUNICIPIO_CURSO)
base_aluno$CPC_FAIXA <- cpc3[match(base_aluno$CHAVE_S_MODALIDADE,cpc3$CHAVE_S_MODALIDADE),CPC_FAIXA]
base_aluno$CPC_CONTINUO <- cpc3[match(base_aluno$CHAVE_S_MODALIDADE,cpc3$CHAVE_S_MODALIDADE),CPC_CONTINUO]
base_aluno$ENADE_BRUTA_FG <- cpc3[match(base_aluno$CHAVE_S_MODALIDADE,cpc3$CHAVE_S_MODALIDADE),BRUTA_FG]
base_aluno$ENADE_BRUTA_CE <- cpc3[match(base_aluno$CHAVE_S_MODALIDADE,cpc3$CHAVE_S_MODALIDADE),BRUTA_CE]
base_aluno$BRUTA_IDD <- cpc3[match(base_aluno$CHAVE_S_MODALIDADE,cpc3$CHAVE_S_MODALIDADE),BRUTA_IDD]
base_aluno$PADRONIZADA_IDD <- cpc3[match(base_aluno$CHAVE_S_MODALIDADE,cpc3$CHAVE_S_MODALIDADE),PADR_IDD]
base_aluno$ENADE_CONTINUA <- cpc3[match(base_aluno$CHAVE_S_MODALIDADE,cpc3$CHAVE_S_MODALIDADE),CONTINUA_ENADE]
base_aluno$CPC_CONTINUO <- cpc3[match(base_aluno$CHAVE_S_MODALIDADE,cpc3$CHAVE_S_MODALIDADE),CPC_CONTINUO]
base_aluno$CPC_FAIXA <- cpc3[match(base_aluno$CHAVE_S_MODALIDADE,cpc3$CHAVE_S_MODALIDADE),CPC_FAIXA]
base_aluno$BRUTA_MESTRES <- cpc3[match(base_aluno$CHAVE_S_MODALIDADE,cpc3$CHAVE_S_MODALIDADE),BRUTA_MESTRES]
base_aluno$PADR_MESTRES <- cpc3[match(base_aluno$CHAVE_S_MODALIDADE,cpc3$CHAVE_S_MODALIDADE),PADR_MESTRES]
base_aluno$BRUTA_DOUTORES <- cpc3[match(base_aluno$CHAVE_S_MODALIDADE,cpc3$CHAVE_S_MODALIDADE),BRUTA_DOUTORES]
base_aluno$PADR_DOUTORES <- cpc3[match(base_aluno$CHAVE_S_MODALIDADE,cpc3$CHAVE_S_MODALIDADE),PADR_DOUTORES]
base_aluno$BRUTA_RT <- cpc3[match(base_aluno$CHAVE_S_MODALIDADE,cpc3$CHAVE_S_MODALIDADE),BRUTA_RT]
base_aluno$PADR_RT <- cpc3[match(base_aluno$CHAVE_S_MODALIDADE,cpc3$CHAVE_S_MODALIDADE),PADR_RT]
base_aluno[is.na(base_aluno$CPC_CONTINUO),"CPC_CONTINUO"] <- cpc2[match(base_aluno[is.na(base_aluno$CPC_CONTINUO),]$CO_CURSO,cpc2$CO_CURSO),CPC_CONTINUO]
base_aluno[is.na(base_aluno$ENADE_BRUTA_FG),"ENADE_BRUTA_FG"] <- cpc2[match(base_aluno[is.na(base_aluno$ENADE_BRUTA_FG),]$CO_CURSO,cpc2$CO_CURSO),BRUTA_FG]
base_aluno[is.na(base_aluno$ENADE_BRUTA_CE),"ENADE_BRUTA_CE"] <- cpc2[match(base_aluno[is.na(base_aluno$ENADE_BRUTA_CE),]$CO_CURSO,cpc2$CO_CURSO),BRUTA_CE]
base_aluno[is.na(base_aluno$BRUTA_IDD),"BRUTA_IDD"] <- cpc2[match(base_aluno[is.na(base_aluno$BRUTA_IDD),]$CO_CURSO,cpc2$CO_CURSO),BRUTA_IDD]
base_aluno[is.na(base_aluno$PADRONIZADA_IDD),"PADRONIZADA_IDD"] <- cpc2[match(base_aluno[is.na(base_aluno$PADRONIZADA_IDD),]$CO_CURSO,cpc2$CO_CURSO),PADR_IDD]
base_aluno[is.na(base_aluno$ENADE_CONTINUA),"ENADE_CONTINUA"] <- cpc2[match(base_aluno[is.na(base_aluno$ENADE_CONTINUA),]$CO_CURSO,cpc2$CO_CURSO),CONTINUA_ENADE]
base_aluno[is.na(base_aluno$CPC_CONTINUO),"CPC_CONTINUO"] <- cpc2[match(base_aluno[is.na(base_aluno$CPC_CONTINUO),]$CO_CURSO,cpc2$CO_CURSO),CPC_CONTINUO]
base_aluno[is.na(base_aluno$CPC_FAIXA),"CPC_FAIXA"] <- cpc2[match(base_aluno[is.na(base_aluno$CPC_FAIXA),]$CO_CURSO,cpc2$CO_CURSO),CPC_FAIXA]
base_aluno[is.na(base_aluno$BRUTA_MESTRES),"BRUTA_MESTRES"] <- cpc2[match(base_aluno[is.na(base_aluno$BRUTA_MESTRES),]$CO_CURSO,cpc2$CO_CURSO),BRUTA_MESTRES]
base_aluno[is.na(base_aluno$PADR_MESTRES),"PADR_MESTRES"] <- cpc2[match(base_aluno[is.na(base_aluno$PADR_MESTRES),]$CO_CURSO,cpc2$CO_CURSO),PADR_MESTRES]
base_aluno[is.na(base_aluno$BRUTA_DOUTORES),"BRUTA_DOUTORES"] <- cpc2[match(base_aluno[is.na(base_aluno$BRUTA_DOUTORES),]$CO_CURSO,cpc2$CO_CURSO),BRUTA_DOUTORES]
base_aluno[is.na(base_aluno$PADR_DOUTORES),"PADR_DOUTORES"] <- cpc2[match(base_aluno[is.na(base_aluno$PADR_DOUTORES),]$CO_CURSO,cpc2$CO_CURSO),PADR_DOUTORES]
base_aluno[is.na(base_aluno$BRUTA_RT),"BRUTA_RT"] <- cpc2[match(base_aluno[is.na(base_aluno$BRUTA_RT),]$CO_CURSO,cpc2$CO_CURSO),BRUTA_RT]
base_aluno[is.na(base_aluno$PADR_RT),"PADR_RT"] <- cpc2[match(base_aluno[is.na(base_aluno$PADR_RT),]$CO_CURSO,cpc2$CO_CURSO),PADR_RT]
base_aluno[is.na(base_aluno$CPC_CONTINUO),"CPC_CONTINUO"] <- cpc1[match(base_aluno[is.na(base_aluno$CPC_CONTINUO),]$CO_CURSO,cpc1$CO_CURSO),CPC_CONTINUO]
base_aluno[is.na(base_aluno$ENADE_BRUTA_FG),"ENADE_BRUTA_FG"] <- cpc1[match(base_aluno[is.na(base_aluno$ENADE_BRUTA_FG),]$CO_CURSO,cpc1$CO_CURSO),BRUTA_FG]
base_aluno[is.na(base_aluno$ENADE_BRUTA_CE),"ENADE_BRUTA_CE"] <- cpc1[match(base_aluno[is.na(base_aluno$ENADE_BRUTA_CE),]$CO_CURSO,cpc1$CO_CURSO),BRUTA_CE]
base_aluno[is.na(base_aluno$BRUTA_IDD),"BRUTA_IDD"] <- cpc1[match(base_aluno[is.na(base_aluno$BRUTA_IDD),]$CO_CURSO,cpc1$CO_CURSO),BRUTA_IDD]
base_aluno[is.na(base_aluno$PADRONIZADA_IDD),"PADRONIZADA_IDD"] <- cpc1[match(base_aluno[is.na(base_aluno$PADRONIZADA_IDD),]$CO_CURSO,cpc1$CO_CURSO),PADR_IDD]
base_aluno[is.na(base_aluno$ENADE_CONTINUA),"ENADE_CONTINUA"] <- cpc1[match(base_aluno[is.na(base_aluno$ENADE_CONTINUA),]$CO_CURSO,cpc1$CO_CURSO),CONTINUA_ENADE]
base_aluno[is.na(base_aluno$CPC_CONTINUO),"CPC_CONTINUO"] <- cpc1[match(base_aluno[is.na(base_aluno$CPC_CONTINUO),]$CO_CURSO,cpc1$CO_CURSO),CPC_CONTINUO]
base_aluno[is.na(base_aluno$CPC_FAIXA),"CPC_FAIXA"] <- cpc1[match(base_aluno[is.na(base_aluno$CPC_FAIXA),]$CO_CURSO,cpc1$CO_CURSO),CPC_FAIXA]
base_aluno[is.na(base_aluno$BRUTA_MESTRES),"BRUTA_MESTRES"] <- cpc1[match(base_aluno[is.na(base_aluno$BRUTA_MESTRES),]$CO_CURSO,cpc1$CO_CURSO),BRUTA_MESTRES]
base_aluno[is.na(base_aluno$PADR_MESTRES),"PADR_MESTRES"] <- cpc1[match(base_aluno[is.na(base_aluno$PADR_MESTRES),]$CO_CURSO,cpc1$CO_CURSO),PADR_MESTRES]
base_aluno[is.na(base_aluno$BRUTA_DOUTORES),"BRUTA_DOUTORES"] <- cpc1[match(base_aluno[is.na(base_aluno$BRUTA_DOUTORES),]$CO_CURSO,cpc1$CO_CURSO),BRUTA_DOUTORES]
base_aluno[is.na(base_aluno$PADR_DOUTORES),"PADR_DOUTORES"] <- cpc1[match(base_aluno[is.na(base_aluno$PADR_DOUTORES),]$CO_CURSO,cpc1$CO_CURSO),PADR_DOUTORES]
base_aluno[is.na(base_aluno$BRUTA_RT),"BRUTA_RT"] <- cpc1[match(base_aluno[is.na(base_aluno$BRUTA_RT),]$CO_CURSO,cpc1$CO_CURSO),BRUTA_RT]
base_aluno[is.na(base_aluno$PADR_RT),"PADR_RT"] <- cpc1[match(base_aluno[is.na(base_aluno$PADR_RT),]$CO_CURSO,cpc1$CO_CURSO),PADR_RT]
base_aluno$IGC_CONTINUO <- igc[match(base_aluno$CO_IES,igc$CO_IES),IGC_CONTINUO]
base_aluno$IGC_FAIXA <- igc[match(base_aluno$CO_IES,igc$CO_IES),IGC_FAIXA]
print("Salvando base")
base_aluno <- base_aluno[c('CHAVE','CHAVE_S_MODALIDADE','CHAVE_CURSO_MUNICIPIO','CO_IES','NO_IES','CO_CURSO','NO_CURSO','CO_GRUPO','NO_GRUPO','CO_MODALIDADE','NO_MODALIDADE','IN_CAPITAL_CURSO','NO_REGIAO_CURSO','CO_MUNICIPIO_CURSO','TOTAL_ALUNO','IN_CONCLUINTE_DM_ALUNO','NU_INGRESSANTES_DM_CURSO','IN_MATRICULA_DM_ALUNO','IN_INGRESSO_TOTAL_DM_ALUNO','NU_VIERAM_ESCOLA_PUBLICA','NU_VIERAM_ESCOLA_PRIVADA','IN_HOMENS','IN_MULHERES','NU_COTA','NU_SEM_COTA','COTA_L1','COTA_L2','COTA_L5','COTA_L6','COTA_L9','COTA_L10','COTA_L13','COTA_L14','COTA_OUTROS','PROUNI_INTEGRAL','PROUNI_PARCIAL','FIES','ENADE_BRUTA_FG','ENADE_BRUTA_CE','ENADE_CONTINUA','CPC_CONTINUO','CPC_FAIXA','IGC_CONTINUO','IGC_FAIXA','BRUTA_MESTRES','PADR_MESTRES','BRUTA_DOUTORES','PADR_DOUTORES','BRUTA_IDD','PADRONIZADA_IDD','BRUTA_RT','PADR_RT')]
write.csv2(paste0(path,"base_aluno_",ano),row.names = F, na = "")
gc()
rm(list = ls(all=T))
Sys.sleep(120)
}
base_agregada(2016)
"C:/Users/Matheus/Desktop/Máquina Matheus/Microdados Ensino Superior/Raw Data/microdados_censo_superior_",ano,"/DADOS/DM_ALUNO/dm_aluno_",ano,"_char.RData"
ano=2016
print("C:/Users/Matheus/Desktop/Máquina Matheus/Microdados Ensino Superior/Raw Data/microdados_censo_superior_",ano,"/DADOS/DM_ALUNO/dm_aluno_",ano,"_char.RData")
print(paste0(print("C:/Users/Matheus/Desktop/Máquina Matheus/Microdados Ensino Superior/Raw Data/microdados_censo_superior_",ano,"/DADOS/DM_ALUNO/dm_aluno_",ano,"_char.RData")))
base_agregada(2016)
carregar_imagem <- function(ano){
load("C:/Users/Matheus/Desktop/Máquina Matheus/Microdados Ensino Superior/Raw Data/microdados_censo_superior_",ano,"/DADOS/DM_ALUNO/dm_aluno_",ano,"_char.RData")
}
carregar_imagem(2016)
ano <- 2016
load("C:/Users/Matheus/Desktop/Máquina Matheus/Microdados Ensino Superior/Raw Data/microdados_censo_superior_",ano,"/DADOS/DM_ALUNO/dm_aluno_",ano,"_char.RData")
load("C:/Users/Matheus/Desktop/Máquina Matheus/Microdados Ensino Superior/Raw Data/microdados_censo_superior_2016/DADOS/DM_ALUNO/dm_aluno_2016_char.RData")
knitr::opts_chunk$set(echo = TRUE)
summary(cars)
plot(pressure)
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(magrittr)
setwd("C:\\Users\\Matheus\\Desktop\\billboard_datacamp")
bb <- read_csv("datasets/bb_chords.csv")
head(bb)
bb_count <- bb %>% group_by(chord) %>% summarise(n=n()) %>% arrange(desc(n))
head(bb_count,20)
bb_count %>% slice(1:20) %>% mutate(share=round(n/sum(n),4)) %>%
ggplot(aes(x=reorder(chord,share),y=share,fill=chord)) +
geom_bar(stat="identity") + theme(legend.position='none') +
coord_flip() + geom_text(aes(label=share), hjust = 1.2, vjust = 0.32, size = 3) +
ylab("Share of Total Chords") + xlab("Chord")
bb <- bb %>% mutate(next_chord=lead(chord),next_title=lead(title),bigram=paste(chord,next_chord)) %>% filter(title==next_title)
bb_bigram_count <- bb %>% group_by(bigram) %>% summarise(n=n()) %>% arrange(desc(n))
head(bb_bigram_count,20)
bb_bigram_count %>% slice(1:20) %>% mutate(share=round(n/sum(n),4)) %>%
ggplot(aes(x=reorder(bigram,share),y=share,fill=bigram)) +
geom_bar(stat="identity") + theme(legend.position="none") +
coord_flip() + geom_text(aes(label=share), hjust = 1.2, vjust = 0.32, size = 3)+
ylab("Share of Total Bigrams") + xlab("Bigrams")
bb_30_artists <- bb %>% select(artist,title) %>% unique() %>% count(artist) %>% arrange(desc(n))
head(bb_30_artists,30)
tags <- tibble(
artist = c('Abba', 'Billy Joel', 'Elton John', 'Stevie Wonder',
'The Rolling Stones', 'The Beatles', 'Eric Clapton'),
instrument = c('piano', 'piano', 'piano', 'piano', 'guitar', 'guitar', 'guitar'))
bb_tagged <- bb %>% inner_join(tags)
top_20 <- bb_count$chord[1:20]
bb_tagged %>% filter(chord %in% top_20) %>% count(chord,instrument,sort=TRUE) %>%
ggplot(aes(x=reorder(chord,n),y=n,fill=instrument)) + geom_bar(stat="identity") + facet_wrap(~instrument) + theme(legend.position='none') + coord_flip()
View(bb_tagged)
top_20 <- bb_bigram_count$chord[1:20]
bb_tagged %>% filter(chord %in% top_20) %>% count(chord,instrument,sort=TRUE) %>%
ggplot(aes(x=reorder(chord,n),y=n,fill=instrument)) + geom_bar(stat="identity") + facet_wrap(~instrument) + theme(legend.position='none') + coord_flip()
top_20 <- bb_bigram_count$bigram[1:20]
bb_tagged %>% filter(bigram %in% top_20) %>% count(bigram,instrument,sort=TRUE) %>%
ggplot(aes(x=reorder(bigram,n),y=n,fill=instrument)) + geom_bar(stat="identity") + facet_wrap(~instrument) + theme(legend.position='none') + coord_flip()
top_20 <- bb_count$chord[1:20]
bb_tagged %>% filter(chord %in% top_20) %>% count(chord,instrument,sort=TRUE) %>%
ggplot(aes(x=reorder(chord,n),y=n,fill=instrument)) + geom_bar(stat="identity") + facet_wrap(~instrument) + theme(legend.position='none') + coord_flip() +
geom_text(aes(label=n), hjust = 1.2, vjust = 0.32, size = 3)
top_20 <- bb_bigram_count$bigram[1:20]
bb_tagged %>% filter(bigram %in% top_20) %>% count(bigram,instrument,sort=TRUE) %>%
ggplot(aes(x=reorder(bigram,n),y=n,fill=instrument)) + geom_bar(stat="identity") + facet_wrap(~instrument) + theme(legend.position='none') + coord_flip() +
geom_text(aes(label=n), hjust = 1.2, vjust = 0.32, size = 3)
View(bb)
